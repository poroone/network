<h1 id="HBjTz">C\C++跨平台原理</h1>
C\C++ 代码会根据不同平台进行编辑对应平台的格式 

windows(PE格式)     Mac(Mach-O格式)     Linux(ELF格式)

<font style="color:#DF2A3F;">! C\C++的跨平台:使用平台想换的编译器生成对应平台的可执行文件</font>

<font style="color:#DF2A3F;">C\C++编译后就可以直接生成平台对应的可执行文件</font>

<h1 id="SKfjJ">java的跨平台原理</h1>
1. *.java  =编译=>  *class(字节码文件 对操作系统来说是不可执行文件)
2. 在对应的平台安装JVM java虚拟机 
3. <font style="color:#DF2A3F;">JVM会加载*.class字节码进行解析字节码文件 后进行解析对应平台的机器码</font>
4. <font style="color:#DF2A3F;">一次编译到处运行</font>
5. 如果代码有语法错误,编译失败就不会生成字节码文件 
6. 从而就不会运行JVM程序 最后导致ajva程序运行失败

<font style="color:#DF2A3F;"> </font>

<h1 id="LdODE">网络协议</h1>
1. HTTP HTTPS SMTP MQTT REMP
2. 在特定的场景下用特定的协议，效果会更高 如处理文件FTP
3. 第三方库如: ios - AFN anroid - OKHTTP3

<h1 id="osLQG">网络协议模型</h1>
ISO国际标准化组织在1985年制定了网络互连模型

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1724833950209-623ff274-b2e4-42e4-865c-ece461e61c4b.png)

> OSI7层参考模型
>

---

7.应用层

6.表示层

5.会话层

4.传输层

3.网络层

2.数据链路层

1.物理层

> TCP/IP-协议
>

---

4.应用层

3.传输层

2.网络层

1.网络接口层



> 用于研究
>

---

5.应用层

4.传输层

3.网络层

2.数据链路层

1.物理层

<h1 id="rEqj3">网络基础概念</h1>
MAC地址 IP地址 路由器 交换机 集线器 同轴电缆



> 计算机之间的通信基础
>

1. 需要知道计算机的ip地址
2. 需要知道计算机的Mac地址(网卡地址),输送数据包到网卡,被网卡接收
3. 如果网卡发现数据的目标mac不是自己,就会将数据丢弃,不会传递给上一层进行处理
4. 数据包中会有
    1. 源ip地址 ->目标ip地址
    2. 源mac地址 ->目标mac地址
    3. 等

<h1 id="mkSl8">网络设备之间的通信</h1>
> 有线连接 - 交叉线网线  直连
>

1. 如何拿到MAC地址 

在第一次发送ICMP协议的时候需要知道对方的ip和MAC地址

从而进行ARP协议(广播协议)只要和他相连接通的设备都会收到这个广播(广播只能同一个网段传播的)

ARP协议为了拿到对方的mack地址(并且具有缓存效果)

    1. ARP完整的一次协议 会进行三步
        1. 进行组包
        2. 进行发送
        3. 进行返MAC

当发送广播的时候目标mack地址是FFFF.FFFF.FFFF (F十六进制在二进制中是1)代表全发送全网段也就是广播全接收

> 有线连接 
>

1. **网线(交叉线)直接连接两台电脑**
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725293965432-a8acdec2-5c6b-49ac-a886-ea014dbb96dd.png)
2. **同轴电缆(半双工通信 容易冲突(冲突域) 不安全全都发 中间断了整个瘫痪 技术老)**
    1. 半双工通信同一时间只允许一个方向的发动
    2. 如果目标有一个多个接收会冲突进行等待下次随机时间发送
    3. 同轴电缆在发送后,会往每个地方都会发送可能会被抓包
    4. 如果中间断开那么信号可能会回来发送给自己从而瘫痪,影响整条线上的设备
    5. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725285782659-024f38aa-7e7c-4b36-9e6f-cf15e1699f5b.png)
3. **集线器(Hub)(半双工通信 容易冲突 不安全 和同轴电缆一样没智 商)**
    1. 同一时间也只允许同一方向的发送
    2. 目标有多个接受会冲突,等待一会会重新发送
    3. 可能会被抓包
    4. 但是其中一个发生问题不会影响到其他的设备
    5. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725286068656-3617c005-2093-4ee1-a230-9587ee5cd69e.png)
4. **网桥(有学习性 隔绝冲突域 )**
    1. 网桥会维护一个表( ip MAC)
    2. 会进行判断发送请求的方向如果是发送方当前域就不会发给别的域
    3. 从而实现隔断,并且可以使域之间内部同时通信不会有冲突 
    4. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725288182392-a3cc4683-da1c-427d-badb-b08eacbe0bd6.png)
5. **交换机 (Switch 局域网的最终方案 | 相当于更多接口的网桥 全双工通信 安全)**
    1. 可以同时进行来回通信
    2. 具有学习能力可以记录 ip mac在记录后不会广播发送 会指定目标发送
    3. 因为会记录所以更加安全,发的包不会发送到别的设备上从而防止被抓包的风险
    4. 如果全球的设备都用交换机连接会形成广播风暴
    5. 
    6. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725293535474-bf527450-f04d-4e05-a6b9-5c2a7835204a.png)
6. **网线直连,同轴电缆,集线器,网桥,交换机**
    1. 连接设备都需要在同一网段 	<font style="color:#74B602;">192.168.1.</font>20 | <font style="color:#74B602;">192.168.1.</font>10   
    2. 连接设备都必须处在同一广播域
7. **路由器(router 隔绝广播域)**
    1. 主机在发送数据之前,首先会判断目标主机的IP地址跟它是否在同一个网段
        1. 在同一个网段:ARP协议 通过交换机\集线器传递数据
        2. 在不同网段:通过路由器转发数据
    2. 网关层(Gateway)
    3.    ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725293851042-3fa6cdf0-206f-448e-9963-14d3cccd7094.png)

<h1 id="mO7Gf">MAC地址</h1>
每个网卡都有一个6字节(48bit)的MAC地址(Media Access Control Address)

全球唯一,固化在网卡的ROM中,由IEEE802标准规定

1. 前三个字节OUI ,组织唯一标识符
2. 由IEEE的注册管理机构分配给厂商
3. oui查询
    1. [standards-oui.ieee.org/oui/oui.txt](https://standards-oui.ieee.org/oui/oui.txt)
    2. [MAC地址查询 - 根据网卡MAC地址查询厂商信息 - MAC地址查厂商 (bmcx.com)](https://mac.bmcx.com/)

| 资质唯一标识符  |  网络接口标识符 |
| --- | --- |
| 40-80-20 | 0E-6A-7D |


<h2 id="uNY5a">Mac地址的表示格式</h2>
> ipconfig /all 可以查看物理地址(网卡地址) 
>

1. windows中 使用 - 进行连接
    1. xx-xx-xx-xx-xx-xx-xx
2. Linux Android Mac iOS 使用:连接
    1. xx:xx:xx:xx:xx:xx
3. packet Tracer
    1. XXXX:XXXX:XXXX
4. 当48位全为1时,代表广播地址
    1. FF-FF-FF-FF-FF-FFF

>  ARP状态
>

dynamic 动态 学习通过ARP协议获取mac 默认缓存两分钟

static 静态 缓存时间较长

 arp -a [主机地址] :查询ARP缓存

arp -d[主机地址] :删除ARP缓存

arp -s 主机地址 MAC地址 :添加一条缓存信息(这是静态缓存,存储时间较久,不同系统的存储时间不同)

<h1 id="w5PLi">IP地址</h1>
<h1 id="spojF">IP地址  </h1>
最初版本是IPV4 ,32bit(4字节),2019年11月25日,全球的IP地址已经用完

后推出ipv6版本 128bit(16字节)

| 1100 0000 | 1010 1000 | 0000 0010 |  0000 0110 |
| --- | --- | --- | --- |
| 第一部分 | 第二部分 | 第三部分 | 第四部分 |
| 192 | 168 | 2 | 6 |


1. ip地址由于两个部分组成:网络标识(网络ID),主机标识(主机ID)
    1. 同一网段的计算机,网络ID相同
    2. 通过子网掩码(subnet mask) 可以计算出网络ID :子网掩码& IP地址

---

IP地址:192.168.2.6

子网掩码:255.255.255.0

网段:192.168.2.0

当前网段可用的主机数是 256-2 应为0(主机位全0代表一个网段) 和255(广播)不可用

---



当子网掩码是1的时候原本ip是什么就是什么

1. 子网掩码是0的时候都是0
    1. 1100 0000 . 1010 1000 . 0000 0010 . 0000 0110
    2. 1111 1111 . 1111 1111 . 1111 1111 . 0000 0000
1. 计算后的 网段192.168.2.0
    1. 网络id 192.168.2
    2. 主机id .0 

<h2 id="vCXlh">IP地址的分类</h2>

1. A类
    1. 网络id必须0开头(8bit) 主机ID (24bit)
    2. 默认子网掩码是255.0.0.0
    3.   ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725351851596-8b3096c6-f08b-48b4-b130-f011b9911e8e.png)
2. B类
    1. 网络id必须10开头(16bit) 主机ID (16bit)
    2. 默认子网掩码是255.255.0.0
    3. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725352128339-f0ba486e-6171-4a68-b52c-06399a019f84.png)
3. C类
    1. 网络id必须110开头(24bit) 主机ID (8bit)
    2. 默认子网掩码是255.255.255.0
    3. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725352329448-df7ef60e-9318-4b22-94b4-570175d3edc8.png)
4. D类
    1. 以1110开头,多播地址
    2. 无子网掩码
    3. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725352398473-6d54f12e-0d09-44bd-97c1-54f4b4ee3cc1.png)
5. E类
    1. 以1111开头 保留位今后使用
    2. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725352402334-dd566b83-fbdc-41f0-a53a-0c6b5de7dc74.png)
6. <font style="background-color:#74B602;">只有A\B\C类地址才能分配给主机</font>
7. 主机ID为全0,代表主机所在的网段
8. 主机ID全为1,代表主机所在的网段的全部主机(广播) 

<h1 id="kGUur">子网掩码的CIDR表示方法</h1>
CIDR (classless inter-Domain Routing): 无类别域间路由

1. 子网掩码的CIDR表示方法
    1. 123.210.100.200/24 代表子网掩码由24个1 ,也就是255.255.255.0	
    2. 123.210.100.200/16 代表子网掩码由16个1 ,也就是255.255.0.0	

<h2 id="J1M1z">子网划分 </h2>
> 等长子网划分
>

A子网 :192.168.0.0/25 ,子网掩码:255.255.255.128

192.168.0.1~192.168.0.126 ,126台

B子网 :192.168.0.128/25 ,子网掩码:255.255.255.128

192.168.0.129~192.168.0.254,126台

> 变长子网划分
>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725503733979-17c8c3c3-5204-493f-8da1-24fd46a781a0.png)

1. 设上图是对192.168.0.0/24 进行变长子网划分
    1. C网段  子网掩码是  255.255.255.128 /25  192-223
    2. B网段  子网掩码是  255.255.255.192 /26  128-191
    3. A网段  子网掩码是  255.255.255.224 / 27 0-127
    4. E网段   子网掩码是 255.255.255.252 /30   224-239
    1. D网段  子网掩码是 255.255.255.252 /30   240-255

<h3 id="rfOZl">测试</h3>
---

A计算机192.168.0.10/24  <==> B计算机192.168.10.10/16 访问

1. 192.168.0.10/24 访问 192.168.10.10的时候会拿自己的子网掩码进行换算
    1. 192.168.0.10/24 => 192.168.0.0
    2. 192.168.10.10/24=>192.168.10.0
    3. 得出真正的ip后发现192.168.0.0 和192.168.10.0不在同一个网段因此无法访问
2. 192.168.10.10/16 访问192.168.0.10/24  的时候同理也会拿自己的子网掩码进行换算
    1. 192.168.10.10/16 => 192.168.0.0
    2. 192.168.0.10/16 => 192.168.0.0
    3. 得出真正的ip后发现192.168.0.0 和192.168.0.0在同一个网段因此B计算机可以访问A计算机
3. 当一个计算机要访问另外一个计算机时会拿自己的子网掩码去进行换算不会拿对方的子网掩码如果在同一个网段就可以进行访问

<h2 id="s67OO">超网</h2>
和子网反过来,他是将多个连续的网段合并成一个更大的网段

如一个有200台计算机使用192.168.0.0/24网段 ,现在希添加200台设备到同一网段

如果有200台设备在192.168.1.0/24网段 ,另外200台在192.168.0.0/24网段

可以进行合并 192.168.1.0/24 192.168.1.0/24为一个网段 192.168.0.0/23(子网掩码往左移动一位)

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725507970550-1dd3e350-0076-446d-80de-d380b7ebaf65.png)



<h2 id="JatQd">合并网段的规律</h2>

1. 假设n是2的k次幂(k>=1)
2. 子网掩码左移K位能够将能够合并n个网段
3. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725510522618-d24d0b32-6349-497c-a859-9186ebe06bdb.png)
4. 假如一个网段的网络号以二进制0结尾,那么由他开始连续的2个网段,能通过左移1位子网掩码进行合并
5. 假如一个网段的网络号以二进制00结尾,那么由他开始连续的4个网段,能通过左移2位子网掩码进行合并
6. 假如一个网段的网络号以二进制000结尾,那么由他开始连续的8个网段,能通过左移3位子网掩码进行合并

<h2 id="IEXqc">判断一个网段是子网还是超网</h2>
1. 如果当前网络的子网掩码位数比子网掩码多就是子网
2. 如果当前网络的子网掩码位数比子网掩码少就是超网
3. 查看网段是A类网还是B类网还是C类网
    1. A类网的子网掩码是8
    2. B类网的子网掩码是16
    3. C类网的子网掩码是24
    4. -------------------------------------------------------------------------
    5. 25.100.0.0/16是一个A类子网
    6. 200.100.0.0/16是一个C类超网

<h1 id="ZP3MU">路由</h1>
1. 路由器默认情况下只知道和他直连的设备,非直连的网段需要通过静态路由,动态路由告诉他
2. 静态路由
    1. 管理员手动添加路由信息
    2. 适用于小规模网络
3. 动态路由
    1. 路由通过路由算则协议(如 RIP , OSPF)自动获取路由信息
    2. 适用于大规模网络

> 特定主机路由
>

指定了要访问的ip地址 写死

| 网络 | 子网掩码 | 下一跳 |
| --- | --- | --- |
| 192.168.1.10 | 255.255.255.255 | 194.163.1.1 |
| 192.168.2.10 | 255.255.255.255 | 194.163.1.1 |


> 网络路由
>

网段

| 网络 | 子网掩码 | 下一跳 |
| --- | --- | --- |
| 192.168.1.0 | 255.255.255.0 | 194.163.1.1 |
| 192.168.2.0 | 255.255.255.0 | 194.163.1.1 |


> 汇总路由
>

范围写大

| 网络 | 子网掩码 | 下一跳 |
| --- | --- | --- |
| 192.168.0.0 | 255.255.0.0 | 194.163.1.1 |
| 192.168.0.0 | 255.255.0.0 | 194.163.1.1 |


> 默认路由
>

默认直接访问下一个路由

| 网络 | 子网掩码 | 下一跳 |
| --- | --- | --- |
| 0.0.0.0 | 0.0.0.0 | 194.163.1.1 |


<h1 id="YoHIf">数据包的传输过程</h1>
数据包的传输

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725542936478-286ed426-e099-47c1-8a19-af7d10bcabd4.png)

1. 数据包在最开始传输的时候会进行封装一个数据包大致为下图如果不是当前网段的就会找当前的路由器进行转发
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725525943861-e77a013c-6a35-423d-bfe3-369b4a948ca2.png)
2. 当前路由器发现目标IP不在我这里更改当前MAC地址为当前路由口的MAC和目标路由口的MAC然后发给下一个路由器1
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725543083100-4b48ef0a-027c-40ce-9a8a-d81fa6e13701.png)
3. 直到找到对应的ip
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725543190382-200df401-5533-45ce-b655-0f42d91fd587.png)

<h1 id="HFXlC">网络 互联网  因特网</h1>

1. 网络 就是多台设备连在一起就是一个小型网络
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725543972822-da891ce9-1aa3-46c8-a340-4a72c7cdc36c.png)
2. 互联网 利用路由器吧多个网段连接起来形成小型的互联网
    1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1725544228647-fc55ba98-2c1f-4372-9a4c-cc95de928717.png)
3. 因特网 全国最大的互联网 就是因特网(Internet)
    1. 将全世界所有的计算机连接在一起
    2. 一般使用大写I开头的Internet特指因特网

<h2 id="OJSD1">ISP   ( internet 服务提供商)</h2>
 如 移动 电信 网通 铁通等 

<h2 id="SF701">网络分类</h2>
1. <font style="background-color:#ECAA04;">局域网</font> ( Local Area Network) LAN
    1. 一般是范围几百米到十几公里内的计算机所构成的计算机网络
    2. 常用于公司 家庭 学校 医院 机关 一栋大楼等
    3. 局域网中使用最广泛的网络技术叫: 以太网(Ethernet)
2. W<font style="background-color:#ECAA04;"></font>LAN (wireless LAN) 无线局域网
3. <font style="background-color:#ECAA04;">城域网</font> (Metroplitan Area Network) MAN
    1. 一般范围是数十公里到数百公里,可以覆盖一个城市
4. <font style="background-color:#ECAA04;">广域网</font>  (Wide Area Netword) WAN
    1. 一般范围是几百公里到几千公里,可以覆盖一个国家,通常都需要租用ISP的线路

<h2 id="Ht4MR">常见的几种接口</h2>
1. FastEthernet 
    1. 快速以太网接口(100M)
2. GigabitEthernet 
    1. 千兆以太网接口
3. Serial (路由器和路由器之间连接)
    1. 串行接口

<h2 id="sdDBQ">公网IP丶私网IP</h2>
1. 公网ip(public)
    1. internet上的路由器只有到达公网的路由表,没有到达私网的路由表
2. 私网ip(Private)
    1. 主要用于局域网,下面是保留的私网网段
        1. A类: 10.0.0.0/8,1个A类网络
        2. B类: 172.16.0.0/16 ~ 172.31.0.0/16, 16个B类网络
        3. C类: 192.168.0.0/24 ~ 192.168.255.0/24,256个C类网络

<h2 id="pXIkW">NAT </h2>
1. 私网IP访问Internet需要进行NAT转换位公网IP
    1. NAT(Network Address Translation)
2. NAT的特点
    1. 可以节约公网IP资源
    2. 会隐藏内部真实IP
3. NAT的分类
    1. 静态转换
        1. 手动配置NAT映射表
        2. 一对一转换
    2. 动态转换
        1. 定义外部地址池,动态随机转换
        2. 一对一转换
    3. PAT(port Address Translation)
        1. 多对一转换,最大程度节约公网IP资源
        2. 采用端口多路复用方式,通过端口号标识不同的数据流
        3. 目前应用最广泛的NAT实现方式

<h1 id="nDWlL">网络分层</h1>
<h2 id="mItf4">网络互连模型</h2>
ISO 组织在1985年制定了网络互连模型

**OSI参考模型,具有7层结构(参考)**

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726798092299-2dc4f6a5-54cb-4d3f-8853-c36de6cf22ab.png)

**TCP/IP 协议模型,具有4层结构(实际应用)**

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726798137138-fee0ddd9-14b1-4fda-bd5e-538a9813aef8.png)

**网络5层模型(学习研究)**

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726798260061-ed5f33d1-27f7-4a21-96d5-0f11a3bf7c75.png)

<h3 id="VVYXJ">请求过程</h3>
1. 客户端进行对包逐一封装
2. 服务端进行对应的解包
    1. 应用层会携带上报文和用户数据 
    2. 运输层会加上段  确保包的可靠传输 重传机制 包的完整机制
    3. 网络层会加上包 附带源ip和目标ip地址
    4. 数据链路层会加上帧 附带mac地址和目标mac地址
    5. 物理层传输的是比特流

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726798421026-6536ad62-20f5-46a8-9dcb-81d4291caf71.png)

1. 应用层会加上报文和 用户的携带数据
2. 传输层会进行加料加料后会叫做段
3. 网络层会进行封装封装后叫包
4. 数据链路层进行封装后为帧
5. 最后经过物理层后就变成比特流进行传输

<h2 id="jwlJz"> 

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726801322764-22d4df3e-5f48-47ef-89df-d4cc9bac1649.png)</h2>
<h1 id="K97aw">物理层(Physical)</h1>
> 物理层定义了接口标准 , 线缆标准 , 传输速率,传输方式等
>

<h2 id="NtlUj">数字信号 模拟信号</h2>
<h3 id="Jgw5i">模拟信号(Analog Signal)</h3>
1. 连续的信号,适合长距离传输
2. 抗干扰能力差,受到干扰时波形变形很难矫正 

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726802294012-c3f8a00f-8b5e-4e04-baac-879f69e7c23f.png)

<h3 id="stCJb">数字信号(Digital Signal)</h3>
1. 离散的信号,不适合长距离传输
2. 抗干扰能力强,收到干扰时波形失真可以修复

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726802607525-9030c22f-f018-4bba-8f62-8f9afa14ea93.png)

<h2 id="McCFO">数据通信模型</h2>

**局域网通信模型**
1. ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726803156368-b268912d-3e8d-4ca1-89fe-14f21ac3b51f.png)
+ 网线不能超过100米 可通过不停接交换机进行加长

**广域网通信模型**

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726803903763-d1ad0161-9524-4d28-8245-d91a2233cb45.png)

<h2 id="RbwrQ"> 信道(Channel)</h2>
<details class="lake-collapse"><summary id="ueaa16ae5"><span class="ne-text">信道</span></summary><p id="ub48c9a7f" class="ne-p"><span class="ne-text"> 信道传输的通道,一条传输介质上(比如网线) 上可以有多条信道</span></p></details>
<details class="lake-collapse"><summary id="u2a5fcb49"><span class="ne-text">单工通信</span></summary><ol class="ne-ol"><li id="u5c00f21b" data-lake-index-type="0"><span class="ne-text">信号只能往一个方向传输,任何时候都不能改变信号的传输方向</span></li><li id="u35ba8a1d" data-lake-index-type="0"><span class="ne-text">无线电广播,有线电视广播 </span></li></ol></details>
<details class="lake-collapse"><summary id="u85f73817"><span class="ne-text">半双工通信</span></summary><ol class="ne-ol"><li id="uc10977a3" data-lake-index-type="0"><span class="ne-text">信号可以双向传输,但必须是交替进行,同一时间只能往一个方向传输</span></li><li id="uf0e02df8" data-lake-index-type="0"><span class="ne-text">对讲机  </span></li></ol></details>
<details class="lake-collapse"><summary id="u28645b18"><span class="ne-text">全双工通信</span></summary><p id="ud1e433c3" class="ne-p"><span class="ne-text">信号可以同时双向传输</span></p><p id="u8a64eaaf" class="ne-p"><span class="ne-text">手机</span></p></details>
<h1 id="FjnFf">数据链路层(Data Link)</h1>
> 链路 : 从一个节点到相邻节点的一段物理线路(有限或 无线) , 中间没有其他交换节点
>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726812677491-0ca733af-5ee3-433e-a77a-d5bd792f6417.png)

1. 数据链路 :  在一条链路上传输数据时,需要有对应的通信协议来控制数据的传输
2. 不同的数据链路,所用的通信协议可能是不同的
3. 广播信道 : CSMA/CD协议 (如同轴电缆,集线器等组成的网络)
4.  点对点信道 : PPP协议(比如两个路由器之间的通信)



1. 数据链路层的三个基本问题
    1. 封装成帧
    2. 透明传输
    3. 差错检验

<h2 id="Rlyo6">1.封装成帧</h2>
会对网络层的数据进行封装 帧数据在中 会在其前面添加帧开始符和尾部添加帧结束符从而进行区分一段数据

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726816861217-bb25f8c6-4bad-4c3d-88b9-18059a09c539.png)

1. 帧 (Frame) 的数据部分
    1. 就是网络层传递下来的数据包（IP数据包,Packet）



1. 最大传输单位MTL(Maximum Transfer Unit)
    1. 每一种数据链路层协议都规定了所能够传送的帧的数据长度上线
    2. 以太网的MTU为1500个字节

<h2 id="ZWu4x">2.透明传输</h2>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726817219450-f40d9c04-434a-4e29-95bc-51481205cff6.png)

1. 使用SOH  (Start Of Header) 帧开始
2. 使用EOT (End Of Transmission) 作为帧结束符

**数据中一旦出现SOH EOT 就需要进行转义 **

为了防止数据中出现SOH 或EOT从而造成数据被丢弃会对数据进行检测

如果有OSH EOT ESC 会在其前面进行添加一个ESC进行转义

在接收方拿到后会进行去除ESC从而拿到完整的数据

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726817333407-b5bada27-4078-44e6-8061-727755634673.png)

<h2 id="Ig0Bv">3.差错检验</h2>
在发送端会将 数据链路层首部和帧的数据部分进行计算 生成FCS 后拼装进行发送

接收端在接收到后也会对 数据链路层首部和帧的数据部分进行计算 用生成的FCS和 发送来的Fcs进行对比如果一样代表数据没有丢失或者改变 否则代表数据有问题 网卡会进行丢包

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1726817572472-3a9d329e-df3a-48b3-9885-630dcb6e79f5.png)

<h2 id="JBA0a">CSMA/CD协议</h2>
CSMA/CD协议  (载波侦听多路访问/冲突检测)

---

1. 使用了CSMA/CD的网络可以被称为以太网(Ethernet) ,他传输的是以太网帧
2. 以太网帧的格式是 : Ethernet V2标准,IEEE的802.3标准
3. 使用最多的是Enternet V2标准

---

1. 为了能够检测正在发送的帧是否产生了冲突,以太网的帧至少是64字节

---

1. 用交换机组件的网络,已经支持全双 工通信,不需要再使用CSMA/CD ,但他传输的帧仍然是以太网帧
2. 所以,用交换机组建的网络,依然可以叫做以太网

---

<h2 id="M4JZi">Ethernet V2帧的格式</h2>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1727187587431-5c2f6bd6-d9c4-44c2-a984-1c6589117c92.png)

MAC层

会生成FCS , FCS 根据数据传输的内容 加 MAC地址和源MAC地址 加 类型(首部) 加 数据生成一个FCS用来代表当前数据

接收方也会生成一个FCS 从而进行对比如果相同代表没有更改过,如果不同代表数据不一致,会进行丢包

数据最多是46-1500 

<h2 id="t2t8N">Ethernet V2标准 </h2>
当数据部分的长度小于46字节时

数据链路层会在数据的后面假如一些字节填充

接收端会将添加的字节去掉 

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1727596649082-288254ad-4b3f-49a6-b640-5ddf27474505.png)

+ 长度总结
    - 以太网帧的数据长度:46-1500字节(蓝色部分)
    - 以太网帧的长度:64-1518字节(源MAC+ 目标MAC+网络类型+数据+FCS)(全部)

<h2 id="iCMTF">PPP协议(Point to Point Protocol)</h2>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728523348615-27bd0e44-f46e-40d9-b4f1-dfaf178b0997.png)

+ Address字段:图中的值是0xFF,形同虚设,点到点通信不需要源MAC,目标MAC地址
+ Control字段:图中的值是0x03,目前没什么作用
+ Protocol字段:内部用到的协议类型
+ 帧开始符,帧结束符:0x7E

<h2 id="OgXUj">PPP协议-字节填充</h2>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728539510850-05b88f03-6d3b-4474-8e66-25236356d78d.png)

+ 将0x7E替换成0x7D5E
+ 将0x7D替换成0x7D5D

<h2 id="URzt4">网卡 (在链路层和物理层)</h2>

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728539618545-c29ee37d-d44d-4c3d-8e75-5b5c9c58cb36.png)

+ 网卡在收到一个帧,首先会进行差错校验,如果校验通过则接受,否则丢弃
+ wireshark抓到的帧没有FCS,应为他抓到的是差错校验通过的帧(帧尾的FCS会被硬件去掉)

<h1 id="jVMyy">网络层(Network)</h1>

+ 网络层数据包(IP数据包,Packet)由首部,数据2部分组成
+ 数据:一般由传输层传递下来的数据段(Segment)
+   ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728542077522-2d10eb7c-d0cd-4b3b-9955-bd187f3c5695.png)

<h2 id="bAO98">网络层首部 - 版本,首部长度,区分服务,总长度</h2>
+ 版本(version)
    - 占4位
    - 0b0100:IPV4
    - 0b0110:IPV6

<h4 id="jjBcY">首部长度(Header Length)</h4>
+ 占4位 ,二进制乘以4才是最终长度
+ 0b0101 : 20(最小值5)
+ 0b1111 : 60(最大值15) 	

<h4 id="CR9l0">网络层首部 - 总长度</h4>

+ 总长度
    - 占16位
    - 首部 + 数据的长度之和,最大值是65535 

    ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728634669752-b10f255f-9e06-439c-914d-89f2db5d6c4a.png)

    - 由于帧的数据不能超过1500字节,所以过大的ip数据包,需要分成片(fragments) 传输给数据链路层
    - 每一片都有自己的网络层首部(ip首部)

<h4 id="ToJKO">网络层首部 - 标识,标志 ,片偏移</h4>

+ 标识(ldentification)
    - 占16位
    - 数据包的ID，当数据包过大进行分片时,同一个数据包的所有片的标识都是一样的
    - 有一个计数器专门管理数据包的ID,每发一个数据包,ID就加1
+ 标志(Flags)
    - 占3位
    - 第1位(Reserved Bit) : 保留
    - 第2位(Dont Fragment) : 1代表不允许分片,0发表允许分片
    - 第3位(More Fragments) : 1代表不是最后一片,0代表是最后一片
+ 片偏移(Fragment Offset)
    - 占13为
    - 片偏移乘以8:字节偏移
    - 为保证片偏移能够存储下所以存储的时候使用进行片偏移除以8
    - 每一片的长度一定是8的整数倍数

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728958073471-cb271d02-bb88-4786-9fd6-94c8ddec7431.png)

网络层首部 - 协议,首部校验和,生存时间

+ 协议(Protocol)
+ 占8位
+ 表明所封装的数据是使用了什么协议

| 协议 | ICPM | IGMP | IP | TCP | EGP | IGP | UDP | IPV6 | ESP | OSPE |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 值(十进制) | 1 | 2 | 4 | 6 | 8 | 9 | 17 | 41 | 50 | 89 |


+ 首部校验和(Header Checksum)
    - 用于检查首部是都有错误
+ 生存时间(Time To Live, TTL)
    - 占8位
    - 每个路由器在转发之前将会TTL减1,一旦发现TTL为0，路由器会返回错误报告
    - 观察使用ping命令后的TTL,能够推测出对方的操作系统,中间经过了多少个路由器
 ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728964743068-1ce17b90-7eb6-470c-9c30-233841f50469.png)

<h1 id="VGwoJ">传输层(Transport)</h1>
+ 传输层有2个协议
+ TCP( Transmission Control Protocol) ,传输控制协议
+ UDP(User Datagram Protocol) ,用户数据报协议

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728969786989-527926a0-8b15-4213-a96e-f341e816e980.png)

<h2 id="nxX44">UDP - 数据格式</h2>
+ UDP是无连接的,减少了建立和释放连接的开销
+ UDP尽最大能力交付,不保证可靠交付
+ 因此不需要维护一些复杂的参数,首部只有8个字节(TCP的首部至少20个字节)
+ UDP数据部分

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728975031256-76a99cac-ed1a-4426-9c5b-5892693e23c3.png)
+ UDP长度
+ 占16位,首部的长度+数据的长度  

<h3 id="HisqT">UDP - 检验和 (Checksum)</h3>
+ 检验和的计算内容: 伪首部 + 首部 + 数据

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728975229901-db6390c2-be06-43ff-9bbc-3ffa80d1933a.png)

<h3 id="POuqw">端口(Port)</h3>
+ UDP首部中端口是占用2字节
+ 可以推测出端口号的取值范围是:0-65535
+ 客户端的源端口是临时开启的随机端口
+ 防火墙可以设置开启\关闭某些端口来提高安全性

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1728978695668-871bc8fb-5beb-4005-b0ec-c39a12d01ebc.png)

+ 常用命令
+ netstat -an : 查看被占用的端口
+ netstat -anb :查看被占用的端口,占用端口的应用程序
+ telnet 主机 端口 :查看是否可以访问主机的某个端口

<h2 id="rHF2l">TCP</h2>
<h3 id="ToyfX">TCP数据格式</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729434712387-a621860f-a601-431b-8f0a-a88478fec255.png)

<h3 id="zAVyy">数据偏移</h3>
+ 占4位: 取值范围是 0x0101~0x1111
+ 乘以4:首部长度(Hander Length)
+ 首部长度是20~60字节



+ 保留
+ 占6位置,目前为0

<h3 id="tpW3Y">TCP与UDP头部区别</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729435430919-5ac92194-4d24-4db6-82c8-dcfea3c3d40a.png)

UDP的首部中有16位的字段记录了整个udp报文段的长度(首部+数据)

但是TCP的首部中仅仅有4位的字段记录了TCP报文段的首部长度,并没有字段记录TCP报文段的数据长度



+ UDP首部中占16位的长度字段是冗余的,纯粹是为了保证首部是32bit对齐
+ TCP\UDP的数据长度,完全可以有IP数据包的首部推测出来
    - 传输层的数据长度=网络层的总长度-网络层的首部长度-传输层的首部长度

<h3 id="FEfQq">TCP - 检验和(Checksum)</h3>
跟UDP一样TCP检验和计算内容:伪首部 + 首部 + 数据

伪首部:占用12字节,仅在计算校验和时起作用,不会传递给网络层

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729436506211-62ac5cff-6da0-4d63-ace6-b2153400d6a0.png)

<h3 id="PvYXK">TCP - 标志位(Flags)</h3>
+ URG(Urgent)

当URG= 1,紧急指针字段才有效,表明当前保温段中有紧急数据,应优先尽快传送



+ ACK (Acknowledgment)

当ACK=1时,确认号字段才有效



+ PSH(Push)



+ RST(Reset)

当RST=1时,表明连接中出现严重差错,必须释放连接,然后再重新建立连接  



+ SYN(Synchronization)

当SYN=1,ACK=0时,表明这是一个建立连接的请求

若对方同意建立连接,则回复SYN=1,ACK=1



+  FIN(Finish)

当FIN=1,代表数据发送完毕,要求释放连接

<h3 id="HD3eY">TCP -  序号 - 确认号 - 窗口</h3>
+ 序号(Sequence Number)
    - 占4字节
    - 首先,传输过程的每一个字节都会有一个编号
    - 在建立连接后,序号代表:这一次传给对方的TCP数据部分的第一字节的编号



+ 确认号(Acknowledgment Number)
    - 占4字节
    - 在建立连接后,确认好代表,期望对方下一次传过来的TCP数据部分的第一个字节的编号



+ 窗口(window)
    - 占2字节
    - 整个字段有流量控制功能,用以告知对方下一次允许发送的数据大小(字节为单位

<h3 id="CR0zJ">可靠控制</h3>
<h4 id="RROMk">停止等待ARQ协议</h4>
+ ARQ(Automatic Requeat-reQuest) 自动重传请求

![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729439421418-aebbe53c-ea4b-4cac-88de-05953134253b.png)

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729489237380-5c4e20bb-4134-44cf-a5f4-af157843112e.png)



<h4 id="YzCQO">连续ARQ协议+ 滑动窗口协议</h4>

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729489548404-b22ece16-9d13-4b6d-bb5f-e60f4979da0c.png)

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729490046884-cdfe259e-4bff-4328-a9ba-62f377ce308d.png)

<h4 id="HFG7Z">SACK(选择性确认)</h4>
+ 在TCP通信过程中,如果发送序列中间某个数据包丢失(比如1 , 2 , <font style="color:#DF2A3F;">3 </font>, 4 , 5 中的<font style="color:#DF2A3F;">3</font>丢失了)
+ TCP会通过重传最后确认的分许后续的分许(最后确认的是2,会重传<font style="color:#DF2A3F;">3</font> 4 5)
+ 这样原先已经正确传输的分组也可能重复发送(比如4 5 ),降低了 TCP 性能
+ 为改善上述情况,发展出SACK(Selective Acknowledgment.,选择性确认 ) 技术
+ 告诉发送方哪些数据丢失,哪些数据已经提前收到
+ 使TCP只重新发送丢失的包(比如 <font style="color:#DF2A3F;">3</font> ),不用发送后续所有的分组(比如4 , 5 )

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729495756193-27626522-6d0a-4d27-a78b-74213583aa40.png)
+ SACK信息会放在TCP首部的选项部分
+ Kind:占1字节,值为5代表这是SACK选项
+ Length:占1字节,表明SACK选项一共占用多少字节
+ left Edge:占4字节左边界
+ Right Edge:占4字节,右边界

+ ![](https://cdn.nlark.com/yuque/0/2024/png/26748482/1729495911843-04f805e5-ec43-4a82-b35a-8eac00c53477.png)
+ 一对边界信息需要占用8字节,由于TCP首部的选项部分最多40字节,所以
+ SACK选项最大携带4组边界信息
+ SACK选项的最大占用字节数=4*8+2=34

<h3 id="bPWqe"> 流量控制</h3>


<h3 id="SbpLC">拥塞控制</h3>
<h3 id="Gq8s4">连接管理</h3>
<h4 id="lV5tj">建立连接</h4>
<h4 id="fBNrS">释放连接</h4>
